<!-- ////////////////// - 1ST IN DOM > PREVENT FLICKER - ////////////////// -->

<script src="/js/theme_setup.js"></script>

<!-- ////////////////// - LINED STYLES AND SCRIPTS - ////////////////// -->

<link rel="stylesheet" type="text/css" href="/css/common.css">
<link rel="stylesheet" type="text/css" href="/css/themes.css">
<link rel="stylesheet" type="text/css" href="/css/breaks.css">
<link rel="stylesheet" type="text/css" href="/css/timer.css">
<link rel="stylesheet" type="text/css" href="/css/modals.css">

<script src="/js/timer.js"></script>

<br>

<!-- ////////////////// - DARK MODE - ////////////////// -->

<li style="display: block;" class="toggle-moon">
  <icon href="#" id="toggle-mode-btn-moon" class="toggle-mode">
    <span class="material-symbols-outlined">brightness_3</span>
  </icon>
</li>

<li style="display: block;" class="toggle-sun">
  <icon href="#" id="toggle-mode-btn-sun" class="toggle-mode">
    <span class="material-symbols-outlined">sunny</span>
  </icon>
</li>

<!-- ////////////////// - NAV - ////////////////// -->

<navbar>
  <li><a href="/account">Password</a></li>
  <section class="vertical-line"></section>
  <li><a href="/logout">Logout</a></li>
</navbar>

<br>

<hr class="divider"><br>

<!-- ////////////////// - GREET - ////////////////// -->

<greet>Hello <%= name %>!</greet><br>

<joke>Time for a break?</joke><br><br>

<hr class="divider">

<!-- ////////////////// - AVAILABLE SLOTS - ////////////////// -->

<% if (breakSlots) { %>
  <slots>
    <%= breakSlots.slots %>
  </slots><br>
  <description class="item1">Slots available</description>
  <% } %>

    <hr class="divider">

    <!-- ////////////////// - SET BREAK MENU - ////////////////// -->

    <form id="break-form" action="/" method="POST" class="break-header">
      <div class="grid-container">
        <span class="grid-item item1">
          <description class="item1">Duration:</description>
        </span>
        <span class="grid-item item2">
          <select id="dropdown" name="duration" class="item2">
            <option value="15">15</option>
            <option value="14">14</option>
            <option value="13">13</option>
            <option value="12">12</option>
            <option value="11">11</option>
            <option value="10">10</option>
            <option value="9">9</option>
            <option value="8">8</option>
            <option value="7">7</option>
            <option value="6">6</option>
            <option value="5">5</option>
            <option value="4">4</option>
            <option value="3">3</option>
            <option value="2">2</option>
            <option value="1">1</option>
          </select>
        </span>
        <span class="grid-item item3">
          <button type="submit" class="break-enter-button item3"><plus>+</plus></button>
        </span>
      </div>
    </form>

    <!-- /////////// BREAK LIST /////////// -->

    <div class="break-container">

      <ul class="break-list">
        <div id="foo" class="main">
          <% let index=0; %>
            <% breakTracker.forEach(details=> { %>

              <% convertToLocalTime=()=> {
                let clientDate = new Date();
                let timezoneOffset = clientDate.getTimezoneOffset();
                let date = new Date(details.startTime);
                let localDate = new Date(date.getTime() + timezoneOffset);
                let timeString = localDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false
                });
                console.log("Client time: ", timeString);
                return timeString;
                }
                %>

                <li class="break-list-item-user">
                  <div class="break-list-item-name-user">

                    <%= details.user %>

                      <div class="timer-container">
                        <span class="numerical-timer <%= `timer-${details._id}` %>">
                          <span class="loader">
                            <filer></filer>
                          </span>
                        </span>
                      </div>
                  </div>

                  <% if (details.user===name) { %>
                    <!--<% console.log(details.user, name) %>-->
                    <a href="/remove/<%= details._id %>" class="remove-user"><span
                        class="material-symbols-outlined">close</span></a>
                    <% } %>

                </li>


                <script>
                  myFingTimer(`<%= details._id %>`);

                  function myFingTimer(id) {
                    //console.log(id);
                    let duration = parseInt('<%= details.duration %>', 10) * 60;
                    let presentTime = new Date().getTime() / 1000;
                    let itemTimeStamp = (new Date('<%= details.startTime %>').getTime() / 1000);
                    let timeCalc = (duration) - (presentTime - itemTimeStamp) + 62;
                    id = id.replace(/&#34;/g, '-');
                    let display = document.querySelector(`.timer-${id}`);
                    display.classList.remove('loading');
                    console.log('id:', id);
                    console.log('display:', display);
                    startTimer(timeCalc, display, id);
                  }
                </script>

                <% }) %>
        </div>
      </ul>

      <% if (1+1===3) { %>
        <description>Break queue</hdescription>
          <ul id="queue-list">
            <% breakQueue.forEach(function (details) { %>
              <li class="break-list-item-user">
                <div class="break-list-item-name-user">
                  <%= details.user %>
                    <div class="timer-container">
                      <span class="numerical-timer <%= `timer-${details._id}` %>">
                        <span class="loader">
                          <filer></filer>
                        </span>
                      </span>
                    </div>
                </div>
              </li>
              <% }); %>
                <% }; %>
          </ul>

    </div>

    <br>

    <!-- ////////////// MODALS ////////////////-->

    <div id="myModal-Neg" class="modal">
      <div class="modal-content-neg">
        <span class="exclamation material-symbols-outlined">exclamation</span>
        <span id="message-neg" class="modal-text"></span>
        <span class="close-neg material-symbols-outlined">close</span>
      </div>
    </div>

    <div id="myModal-Pos" class="modal">
      <div class="modal-content-pos">
        <span class="check material-symbols-outlined">check</span>
        <span id="message-pos" class="modal-text"></span>
        <span class="close-pos material-symbols-outlined">close</span>
      </div>
    </div>

    <!-- ////////////////// - FETCH JS FILES - ////////////////// -->

    <script src="/js/toggle.js"></script>
    <script src="/js/modals.js"></script>
    <script src="/sortable/Sortable.min.js"></script>
    <script src="/js/sort.js"></script>