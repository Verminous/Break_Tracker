<!-- ////////////////// - HEADER - ////////////////// -->

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Baloo+Bhai|Candal|Chewy&display=swap">
<link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">

<link rel="stylesheet" type="text/css" href="/css/common.css">
<link rel="stylesheet" type="text/css" href="/css/style.css">

<script src="/js/timer.js"></script>

<br>

<a href="#" id="toggle-mode-btn" class="text-link">Toggle Mode</a><br><br>

<b>Break Tracker</b><br>
(agent page)<br><br><br>
<br><b>Hello there <%= name %>!</b><br>

<li><a href="/account">Change Password</a></li>
<li><a href="/logout">Logout</a></li>

<!-- ////////////////// - TO DO LIST - ////////////////// -->

<div class="todo-container">

  <h2>Breaks</h2>

  <form action="/" method="POST" class="todo-header">
    <label for="duration">Duration (in minutes):</label>
    <select id="dropdown" name="duration">
      <option value="15">15</option>
      <option value="10">10</option>
      <option value="5">5</option>
      <option value="1">1</option>
    </select>
    <button type="submit"><span class="fas fa-plus"></span></button>
  </form>

  <ul class="todo-list">
    <% let index=0; %>
    <% breakTracker.forEach(details=> { %>
    <% 
    convertToLocalTime = () => {
      let clientDate = new Date();
      let timezoneOffset = clientDate.getTimezoneOffset();
      let date = new Date(details.startTime);
      let localDate = new Date(date.getTime() + timezoneOffset);
      let timeString = localDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
      return timeString;
    }
    %>
    <li class="todo-list-item">
      <div class="todo-list-item-name">
        <div class="user-name">
          <b><%= details.user %></b>
        </div>
        <div class="timer-container">
          <b><span class="numerical-timer <%= `timer-${details._id}` %>"></span></b>
        </div>
      </div>

      <% if (details.user === name) { %>
      <!--<% console.log(details.user, name) %>-->
      <a href="/remove/<%= details._id %>" class="remove">
        <span class="fas fa-times"></span>
      </a>
      <% } %>

    </li>

    <script>
      myFingTimer(`<%= details._id %>`);

      function myFingTimer(id) {
        //console.log(id);
        let duration = parseInt('<%= details.duration %>', 10) * 60;
        let presentTime = new Date().getTime() / 1000;
        let itemTimeStamp = (new Date('<%= details.startTime %>').getTime() / 1000);
        let timeCalc = (duration) - (presentTime - itemTimeStamp) + 61;
        id = id.replace(/&#34;/g, '-');
        let display = document.querySelector(`.timer-${id}`);
        console.log('id:', id);
        console.log('display:', display);
        startTimer(timeCalc, display, id);
      }
    </script>

    <% }) %>
  </ul>
</div>

<script src="/js/dark.js"></script>