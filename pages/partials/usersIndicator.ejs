<!-- ////////////// SOCKET.IO - GLOBAL RELOAD ////////////////-->

<script src="/socket.io/socket.io.js"></script>

<!-- ////// - USERS ONLINE INDICATOR - ////////-->

<script>
    const socketOptions = {};
  <% if (typeof currentUser !== 'undefined') { %>
        socketOptions.query = { username: '<%= currentUser.username %>' };
  <% } %>
  const socket = io(socketOptions);

    socket.on('connect', () => {
        console.log('SOCKET.IO - Connected to server');
    });

    socket.on('disconnect', () => {
        console.log('SOCKET.IO - Disconnected from server');
    });

    socket.on('reload', () => {
        console.log('Reload event received');
        setTimeout(() => location.reload(), 100);
    });

    socket.on('userCount', (count) => {
        document.querySelector('#userCount').innerText = count;
    });

    socket.on('userList', (users) => {
        const userList = document.querySelector('#userList');
        userList.innerHTML = '';
        users.forEach((user) => {
            const listItem = document.createElement('li');
            listItem.innerText = user;
            userList.appendChild(listItem);
        });
    });

</script>


<script>

    function toggleUserList() {
        const userList = document.querySelector('#userList');
        if (userList.style.display === 'block') {
            userList.style.display = 'none';
            userList.classList.remove('show');
        } else {
            userList.style.display = 'block';
            setTimeout(() => {
                userList.classList.add('show');
            }, 10);
        }
    }

    document.addEventListener('click', (event) => {
        const userList = document.querySelector('#userList');
        const userCountButton = document.querySelector('#userCount');

        if (!userList.contains(event.target) && !userCountButton.contains(event.target)) {
            userList.style.display = 'none';
            userList.classList.remove('show');
        }
    });

</script>

<span class="users-container">
    <button id="userCount" onclick="toggleUserList()">0</button>
    <ul id="userList"></ul>
</span>

<style>

#userCount {
    top: 105px;
    margin-right: -35px;
    background-color: var(--break-list-item-background-color);
    border: 2px solid var(--hr-divider-color);
    color: var(--text-color);
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 14px;
    width: 30px;
    height: 30px;
    line-height: 26px;
    border-radius: 50%;
    cursor: pointer;
    outline: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
    position: absolute;
}

#userList {
    display: block;
    position: absolute;
    top: 148px;
    left: 50%;
    transform: translateX(60px);
    background-color: var(--navigation-dropdown-background-color);
    min-width: 100px;
    max-width: 200px;
    box-shadow: 0px 8px 16px 0px #00000033;
    list-style-type: none;
    margin: 0;
    padding: 0;
    border-radius: 4px;

    z-index: 1;
}

#userList li {
    padding: 8px 2px;
    text-decoration: none;
    color: var(--text-color);
    display: block;
    white-space: nowrap;
}

#userList li:hover {

}



    </style>